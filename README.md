# GeoGallery

Приложение для добавления и управления пользовательскими маркерами на карте с возможностью прикреплять фотографии к каждой точке.

---

## Оглавление
- [GeoGallery](#geogallery)
  - [Оглавление](#оглавление)
  - [Описание](#описание)
  - [Требования](#требования)
  - [Установка и запуск](#установка-и-запуск)
  - [Принятые решения при реализации](#принятые-решения-при-реализации)
  - [Структура и архитектура проекта](#структура-и-архитектура-проекта)
  - [Схема базы данных](#схема-базы-данных)
  - [Дополнительные реализованные функции](#дополнительные-реализованные-функции)
  - [Известные проблемы и ограничения](#известные-проблемы-и-ограничения)
  - [Возможные направления для развития](#возможные-направления-для-развития)

  

## Описание

**GeoGallery** — мобильное приложение на базе Expo, позволяющее:
- Добавлять пользовательские точки на карту долгим нажатием.
- Просматривать и редактировать детали каждой точки (название, фотографии).
- Загружать и удалять изображения, связанные с каждой точкой.
- Использовать кастомные маркеры на Android и цветные подписи на iOS.
- Данные маркеров и изображений сохраняются локально с помощью базы данных SQLite, не теряются при перезапуске приложения.
- Возможность удалять маркеры (все связанные изображения также удаляются автоматически).

## Требования

- Node.js (LTS версия)
- Yarn или npm
- Expo SDK 49+ (рекомендуется последняя версия)
- Expo Go на мобильном устройстве для тестирования
- Git (для загрузки/клонирования репозитория)

## Установка и запуск

1. **Клонируйте репозиторий:**

   ```bash
   git clone <ссылка_на_репозиторий>
   cd GeoGallery2
   ```

2. **Установите зависимости:**

   ```bash
   npm install
   ```

3. **Запустите проект:**
    ```bash
   npx expo start
   ```

4. **Сканируйте QR-код с помощью приложения Expo Go** (на Android/iOS) для запуска приложения на мобильном устройстве.
   
## Принятые решения при реализации

- Для навигации между экранами используется **expo-router** с файловой структурой страниц. Это обеспечивает современную, гибкую и масштабируемую маршрутизацию.
- Состояние всех маркеров и связанных с ними данных управляется через React Context (DatabaseContext). Контекст инкапсулирует операции с базой данных и предоставляет асинхронные методы для работы с маркерами и изображениями.
- Для хранения данных используется локальная база данных SQLite через модуль expo-sqlite. Создаются две связанные таблицы: одна для маркеров, вторая для фотографий, связанных с каждым маркером (реализация связей через внешний ключ и каскадное удаление).
- Для выбора изображений используется пакет `expo-image-picker` с учётом рекомендаций по синтаксису для последних версий Expo SDK. Это гарантирует совместимость и стабильную работу на всех поддерживаемых платформах.
- Кастомизация маркеров реализована индивидуально для платформ:
    - На iOS используется цветная надпись, позволяющая выбрать цвет при создании точки.
    - На Android отображается png-иконка из папки assets.
- Все компоненты написаны с использованием TypeScript, что обеспечивает строгую типизацию и упрощает сопровождение кода.
- Модальные окна, выбор цвета и обработка пользовательского ввода реализованы с помощью стандартных компонентов React Native и кастомных стилей для лучшего UX.
- Реализована обработка ошибок для всех ключевых сценариев: выбор изображений, работа с навигацией, обработка данных, взаимодействие с пользователем.

## Структура и архитектура проекта
- /app/ — основные экраны (карта, детали маркера, роутинг).
- /components/ — переиспользуемые UI-компоненты (MapView, список фотографий и др.).
- /contexts/DatabaseContext.tsx — глобальный React Context для доступа к данным и управления базой.
- /database/ — слой работы с базой данных: определение схемы, миграции, CRUD-операции.
- /types.ts — все интерфейсы и типы TypeScript.
- /assets/ — изображения и иконки.
- /package.json — все зависимости, включая expo, react-native-maps, expo-image-picker, expo-sqlite и др.

## Схема базы данных

В приложении используется база данных SQLite с двумя связанными таблицами:

- **markers**  
  | Поле      | Тип данных | Описание                      |
  |-----------|------------|-------------------------------|
  | id        | INTEGER    | Первичный ключ, автонумерация |
  | latitude  | REAL       | Широта                        |
  | longitude | REAL       | Долгота                       |
  | label     | TEXT       | Название точки                |
  | color     | TEXT       | Цвет маркера                  |
  | created_at| DATETIME   | Дата создания                 |

- **marker_images**  
  | Поле      | Тип данных | Описание                                  |
  |-----------|------------|-------------------------------------------|
  | id        | INTEGER    | Первичный ключ, автонумерация             |
  | marker_id | INTEGER    | Внешний ключ на markers(id)               |
  | uri       | TEXT       | Путь к изображению                        |
  | added_at  | DATETIME   | Дата добавления изображения               |

- Таблицы связаны по `marker_id` (внешний ключ, каскадное удаление связанных изображений при удалении маркера).


## Дополнительные реализованные функции

- **Кастомные маркеры:**
    - На iOS реализованы цветные подписи с выбором цвета для каждой точки.
    - На Android используется кастомная PNG-иконка маркера.
- **Предпросмотр изображений:**  
    - Пользователь может открыть изображение в полноэкранном режиме при нажатии на миниатюру.
- **Улучшенный выбор цвета:**  
    - На iOS для новых маркеров можно выбрать цвет с помощью визуальных цветных кружков.
- **SafeArea:**  
    - Использование `react-native-safe-area-context` для правильного расположения кнопок и элементов интерфейса на устройствах с вырезами и нестандартными рамками.
- **Обработка ошибок:**  
    - Приложение информирует пользователя о проблемах с загрузкой изображений, ошибках навигации, отсутствии доступа и других возможных сбоях.

## Известные проблемы и ограничения

- **Ограничения работы с файлами:**
  - Expo Go не позволяет работать с файлами вне песочницы приложения, доступны только изображения из медиатеки пользователя.
- **Особенности отображения маркеров:**
  - На некоторых устройствах Android кастомная иконка маркера может отображаться с искажениями из-за особенностей библиотеки react-native-maps.
- **Производительность:**
  - При большом количестве точек и изображений возможно замедление интерфейса.
- **Нет поиска и фильтрации:**
  - В текущей версии нельзя быстро найти точку по названию или описанию.
- **Нет Drag & Drop:**
  - Перемещение маркеров по карте не реализовано.


## Возможные направления для развития

- Реализация геолокации пользователя и уведомлений (следующий этап лабораторных).
- Перемещение маркеров (Drag & Drop) и анимация точек на карте.
- Добавление фильтрации и поиска по точкам.
- Кастомизация тем и улучшение пользовательского интерфейса.
- Экспорт/импорт данных, синхронизация с облаком или Google Диском.
- Масштабируемые списки и оптимизация производительности для большого количества данных.
- Автоматическое резервное копирование базы данных.